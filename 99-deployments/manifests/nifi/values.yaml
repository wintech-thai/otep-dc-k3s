domain: nifi.otep.triple-t.co

nifi:
  enabled: true
  nameOverride: nifi

  ingress:
    enabled: true
    ingressClassName: nginx
    hostName: nifi.otep.triple-t.co
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    tls:
      - secretName: nifi-cert
        hosts:
          - nifi.otep.triple-t.co

  volumeClaims:
    config:
      storageClass: "local-path"
    state:
      storageClass: "local-path"
    flowfile:
      storageClass: "local-path"
    content:
      storageClass: "local-path"
    provenance:
      storageClass: "local-path"
    logs:
      storageClass: "local-path"

  global:
    nifi:
      nodeCount: 1
  
    # OpenID Connect (OIDC) Authentication à¸–à¹‰à¸²à¹ƒà¸Šà¹‰à¸­à¸±à¸™à¸™à¸µà¹‰ basic authen à¸ˆà¸°à¹„à¸¡à¹ˆà¸—à¸³à¸‡à¸²à¸™
    oidc:
      enabled: true
      oidc_url: "https://keycloak.otep.triple-t.co/realms/otep-prod/.well-known/openid-configuration"
      client_id: "otep-sso"
      client_secret: "riB5JLPYmQ0aAUoehnGKTMrayOi05oiD" # TODO : à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™ secret
      claim_identifying_user: "preferred_username"
      initial_admin_identity: "pjame.fb@gmail.com"

  resources:
    requests:
      cpu: 200m
      memory: 1Gi

  jvmHeap:
    min: 256m
    max: 512m

  zookeeper:
    image:
      registry: docker.io
      repository: bitnamilegacy/zookeeper
      tag: 3.9.3
      pullPolicy: IfNotPresent

    global:
      security:
        allowInsecureImages: true

  logbackConfig: |
    <?xml version="1.0" encoding="UTF-8"?>
    <configuration>

      <appender name="APP_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${org.apache.nifi.bootstrap.config.log.dir}/nifi-app.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
          <fileNamePattern>${org.apache.nifi.bootstrap.config.log.dir}/nifi-app_%d{yyyy-MM-dd}.log</fileNamePattern>
          <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
          <pattern>%d{yyyy-MM-dd HH:mm:ss,SSS} %-5level [%thread] %logger - %msg%n</pattern>
        </encoder>
      </appender>

      <root level="INFO">
        <appender-ref ref="APP_FILE"/>
      </root>

      <!-- ðŸ” OIDC + Auth DEBUG -->
      <logger name="org.apache.nifi.web.security.oidc" level="DEBUG"/>
      <logger name="org.apache.nifi.web.security" level="DEBUG"/>
      <logger name="org.apache.nifi.authorization" level="DEBUG"/>

    </configuration>
